{"version":3,"file":"index.js","sources":["../../../../../../../src/plugin/external/typedoc/ts-links/Resolver.js","../../../../../../../src/plugin/external/typedoc/ts-links/index.js"],"sourcesContent":["import fs                     from 'node:fs';\r\nimport path                   from 'node:path';\r\nimport { fileURLToPath }      from 'node:url';\r\n\r\nimport { Application }        from 'typedoc';\r\n\r\nexport class Resolver\r\n{\r\n   /** @type {[]} */\r\n   static #emptyArray = [];\r\n\r\n   /** @type {Application} */\r\n   #app;\r\n\r\n   /**\r\n    * @type {ResolverOptions}\r\n    */\r\n   #options;\r\n\r\n   /**\r\n    * Typedoc version support.\r\n    *\r\n    * @type {{objectReturn: boolean}}\r\n    */\r\n   #supports = {\r\n      objectReturn: false\r\n   };\r\n\r\n   /**\r\n    * @type {Map<string, import('../../../../../types/index-json').DataSymbolLinks>}\r\n    */\r\n   #urlMapping;\r\n\r\n   /**\r\n    * @param {Application} app - Typedoc application\r\n    *\r\n    * @param {ResolverOptions}   options - Options.\r\n    */\r\n   constructor(app, options)\r\n   {\r\n      const pkgName = '[@typhonjs-typedoc/typedoc/ts-links]';\r\n\r\n      if (typeof options !== 'object') { throw new TypeError(`${pkgName} 'options' is not an object.`); }\r\n      if (typeof options?.year !== 'number') { throw new TypeError(`${pkgName} 'options.year' is not a number.`); }\r\n      if (typeof options?.lib !== 'string') { throw new TypeError(`${pkgName} 'options.lib' is not a string.`); }\r\n      if (typeof options?.host !== 'string') { throw new TypeError(`${pkgName} 'options.host' is not a string.`); }\r\n\r\n      this.#app = app;\r\n      this.#options = options;\r\n\r\n      const dataPath = path.resolve(fileURLToPath(import.meta.url),\r\n       `../../../../../../../../data/${options.year}/${options.lib}/reflection-mapping.json`);\r\n\r\n      try\r\n      {\r\n         fs.accessSync(dataPath, fs.constants.R_OK);\r\n\r\n         this.#urlMapping = new Map(Object.entries(JSON.parse(fs.readFileSync(dataPath, 'utf-8'))));\r\n      }\r\n      catch (err)\r\n      {\r\n         throw new Error(`${pkgName} Could not open url mapping file at:\\n${dataPath}\\n${err.message}`);\r\n      }\r\n\r\n      const version = Application.VERSION.split(/[.-]/);\r\n      this.#supports.objectReturn = +version[1] > 23 || +version[2] >= 26;\r\n\r\n      this.#app.converter.addUnknownSymbolResolver(this.#handleUnknownSymbol.bind(this));\r\n   }\r\n\r\n   /**\r\n    * Attempts to resolve unknown symbols against library declarations provided by this module.\r\n    *\r\n    * @param {import('typedoc').DeclarationReference} ref - Declaration reference.\r\n    *\r\n    * @returns {import('typedoc').ExternalResolveResult | void} Resolve result.\r\n    */\r\n   #handleUnknownSymbol(ref)\r\n   {\r\n      if (ref.moduleSource === 'typescript' || (!ref.moduleSource && ref.resolutionStart === 'global'))\r\n      {\r\n         const symbolPath = ref.symbolReference?.path ?? Resolver.#emptyArray;\r\n\r\n         const name = symbolPath?.map((path) => path.path).join('.');\r\n\r\n         if (!name) { return; }\r\n\r\n         const result = this.#urlMapping.get(name)?.doc_url;\r\n\r\n         if (this.#supports.objectReturn && result)\r\n         {\r\n            /** @type {import('typedoc').ExternalResolveResult} */\r\n            return {\r\n               target: `${this.#options.host}/${result}`,\r\n               caption: name,\r\n            };\r\n         }\r\n\r\n         return result;\r\n      }\r\n   }\r\n}\r\n\r\n/**\r\n * @typedef {object} ResolverOptions\r\n *\r\n * @property {number}   year - The generate config year to lookup.\r\n *\r\n * @property {string}   lib - The generate config lib to lookup.\r\n *\r\n * @property {string}   host - The main URL location of the hosted docs.\r\n */","import { Resolver }  from './Resolver.js';\r\n\r\n/**\r\n * Provides a plugin for Typedoc to link Typescript lib.d.ts symbols to external documentation.\r\n *\r\n * @param {import('typedoc').Application} app - Typedoc Application\r\n */\r\nexport function load(app)\r\n{\r\n   new Resolver(app, { year: REPLACE_YEAR, lib: REPLACE_LIB, host: REPLACE_HOST }); // eslint-disable-line no-undef\r\n}\r\n\r\n"],"names":[],"mappings":";;;;;AAMO,MAAM,QAAQ;AACrB;AACA;AACA,GAAG,OAAO,WAAW,GAAG,EAAE,CAAC;AAC3B;AACA;AACA,GAAG,IAAI,CAAC;AACR;AACA;AACA;AACA;AACA,GAAG,QAAQ,CAAC;AACZ;AACA;AACA;AACA;AACA;AACA;AACA,GAAG,SAAS,GAAG;AACf,MAAM,YAAY,EAAE,KAAK;AACzB,IAAI,CAAC;AACL;AACA;AACA;AACA;AACA,GAAG,WAAW,CAAC;AACf;AACA;AACA;AACA;AACA;AACA;AACA,GAAG,WAAW,CAAC,GAAG,EAAE,OAAO;AAC3B,GAAG;AACH,MAAM,MAAM,OAAO,GAAG,sCAAsC,CAAC;AAC7D;AACA,MAAM,IAAI,OAAO,OAAO,KAAK,QAAQ,EAAE,EAAE,MAAM,IAAI,SAAS,CAAC,CAAC,EAAE,OAAO,CAAC,4BAA4B,CAAC,CAAC,CAAC,EAAE;AACzG,MAAM,IAAI,OAAO,OAAO,EAAE,IAAI,KAAK,QAAQ,EAAE,EAAE,MAAM,IAAI,SAAS,CAAC,CAAC,EAAE,OAAO,CAAC,gCAAgC,CAAC,CAAC,CAAC,EAAE;AACnH,MAAM,IAAI,OAAO,OAAO,EAAE,GAAG,KAAK,QAAQ,EAAE,EAAE,MAAM,IAAI,SAAS,CAAC,CAAC,EAAE,OAAO,CAAC,+BAA+B,CAAC,CAAC,CAAC,EAAE;AACjH,MAAM,IAAI,OAAO,OAAO,EAAE,IAAI,KAAK,QAAQ,EAAE,EAAE,MAAM,IAAI,SAAS,CAAC,CAAC,EAAE,OAAO,CAAC,gCAAgC,CAAC,CAAC,CAAC,EAAE;AACnH;AACA,MAAM,IAAI,CAAC,IAAI,GAAG,GAAG,CAAC;AACtB,MAAM,IAAI,CAAC,QAAQ,GAAG,OAAO,CAAC;AAC9B;AACA,MAAM,MAAM,QAAQ,GAAG,IAAI,CAAC,OAAO,CAAC,aAAa,CAAC,MAAM,CAAC,IAAI,CAAC,GAAG,CAAC;AAClE,OAAO,CAAC,6BAA6B,EAAE,OAAO,CAAC,IAAI,CAAC,CAAC,EAAE,OAAO,CAAC,GAAG,CAAC,wBAAwB,CAAC,CAAC,CAAC;AAC9F;AACA,MAAM;AACN,MAAM;AACN,SAAS,EAAE,CAAC,UAAU,CAAC,QAAQ,EAAE,EAAE,CAAC,SAAS,CAAC,IAAI,CAAC,CAAC;AACpD;AACA,SAAS,IAAI,CAAC,WAAW,GAAG,IAAI,GAAG,CAAC,MAAM,CAAC,OAAO,CAAC,IAAI,CAAC,KAAK,CAAC,EAAE,CAAC,YAAY,CAAC,QAAQ,EAAE,OAAO,CAAC,CAAC,CAAC,CAAC,CAAC;AACpG,OAAO;AACP,MAAM,OAAO,GAAG;AAChB,MAAM;AACN,SAAS,MAAM,IAAI,KAAK,CAAC,CAAC,EAAE,OAAO,CAAC,sCAAsC,EAAE,QAAQ,CAAC,EAAE,EAAE,GAAG,CAAC,OAAO,CAAC,CAAC,CAAC,CAAC;AACxG,OAAO;AACP;AACA,MAAM,MAAM,OAAO,GAAG,WAAW,CAAC,OAAO,CAAC,KAAK,CAAC,MAAM,CAAC,CAAC;AACxD,MAAM,IAAI,CAAC,SAAS,CAAC,YAAY,GAAG,CAAC,OAAO,CAAC,CAAC,CAAC,GAAG,EAAE,IAAI,CAAC,OAAO,CAAC,CAAC,CAAC,IAAI,EAAE,CAAC;AAC1E;AACA,MAAM,IAAI,CAAC,IAAI,CAAC,SAAS,CAAC,wBAAwB,CAAC,IAAI,CAAC,oBAAoB,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,CAAC;AACzF,IAAI;AACJ;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG,oBAAoB,CAAC,GAAG;AAC3B,GAAG;AACH,MAAM,IAAI,GAAG,CAAC,YAAY,KAAK,YAAY,KAAK,CAAC,GAAG,CAAC,YAAY,IAAI,GAAG,CAAC,eAAe,KAAK,QAAQ,CAAC;AACtG,MAAM;AACN,SAAS,MAAM,UAAU,GAAG,GAAG,CAAC,eAAe,EAAE,IAAI,IAAI,QAAQ,CAAC,WAAW,CAAC;AAC9E;AACA,SAAS,MAAM,IAAI,GAAG,UAAU,EAAE,GAAG,CAAC,CAAC,IAAI,KAAK,IAAI,CAAC,IAAI,CAAC,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC;AACrE;AACA,SAAS,IAAI,CAAC,IAAI,EAAE,EAAE,OAAO,EAAE;AAC/B;AACA,SAAS,MAAM,MAAM,GAAG,IAAI,CAAC,WAAW,CAAC,GAAG,CAAC,IAAI,CAAC,EAAE,OAAO,CAAC;AAC5D;AACA,SAAS,IAAI,IAAI,CAAC,SAAS,CAAC,YAAY,IAAI,MAAM;AAClD,SAAS;AACT;AACA,YAAY,OAAO;AACnB,eAAe,MAAM,EAAE,CAAC,EAAE,IAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,CAAC,EAAE,MAAM,CAAC,CAAC;AACxD,eAAe,OAAO,EAAE,IAAI;AAC5B,aAAa,CAAC;AACd,UAAU;AACV;AACA,SAAS,OAAO,MAAM,CAAC;AACvB,OAAO;AACP,IAAI;AACJ,CAAC;AACD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AC7GA;AACA;AACA;AACA;AACA;AACO,SAAS,IAAI,CAAC,GAAG;AACxB;AACA,GAAG,IAAI,QAAQ,CAAC,GAAG,EAAE,EAAE,IAAI,EAAE,IAAY,EAAE,GAAG,EAAE,QAAW,EAAE,IAAI,EAAE,4DAAY,EAAE,CAAC,CAAC;AACnF;;;;"}